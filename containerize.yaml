_schema-version: '1.0'
repository: registry-server
tag: latest
before-all:
  - npx cds build --production
  - mkdir -p app/html5-deployer/resources
  - npm i --prefix app/app
  - npm run build --prefix app/app
  # zip filename should match the archiveName specified in ui5-deploy.yaml
  - cp -f app/app/dist/app.zip app/html5-deployer/resources/app.zip
  - npm i --prefix app/equipments
  - npm run build --prefix app/equipments
  # zip filename should match the archiveName specified in ui5-deploy.yaml
  - cp -f app/equipments/dist/equipments.zip app/html5-deployer/resources/equipments.zip
modules:
  - name: 4IoT-Equipment-Management-srv
    build-parameters:
      buildpack:
        type: nodejs
        builder: builder-jammy-base
        path: gen/srv
        env:
          BP_NODE_RUN_SCRIPTS: ""
  - name: 4IoT-Equipment-Management-sidecar
    build-parameters:
      buildpack:
        type: nodejs
        builder: builder-jammy-base
        path: gen/mtx/sidecar
        env:
          BP_NODE_RUN_SCRIPTS: ""
  - name: 4IoT-Equipment-Management-html5-deployer
    build-parameters:
      buildpack:
        type: nodejs
        builder: builder-jammy-base
        path: app/html5-deployer
        env:
          BP_NODE_RUN_SCRIPTS: ""
